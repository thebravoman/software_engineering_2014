require "csv"
teams_hash=Hash.new{|hash, key| hash[key] = []}
time_hash=Hash.new{|hash, key| hash[key] = []}
p = Hash.new
dir = ARGV[0] + "class009_homework/"

f = File.open("#{dir}project_to_names.csv", "r")
f.each do |line|
	if line.start_with? ',' 
		elsif !line.include?("Progect Name")
  			team = line.split(",").first
			names = line.split(",").last
			teams_hash[team] << names.gsub("\n","")
		end
end
f.close

Dir.glob("#{dir}"+"*").each do |report|
team_name = report.split(/\//).last.split(".").first
log = `git log --until=Mon--Oct--27--20:00:00--2014 #{report}`
					 if !log.empty?
						#print "ON TIME"
					 	team_name = report.split(/\//).last.split(".").first
					   	time_hash[team_name] << "2"
					  elsif log.empty?
						#print "NOT ON TIME"
					   	team_name1 = report.split(/\//).last.split(".").first
					   	time_hash[team_name1] << "1"
					  end
end
	teams_hash.each do |team, names|
		time_hash.each do |team1, time|
			if team == team1
				names.each do |n|
					p[n] = time
				end
			end
		end
	end
CSV.open("result.csv", "w") do |csv|
	p.sort.each do |x,y|
		csv <<[x,y].flatten
	end
end
